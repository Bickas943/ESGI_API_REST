<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Documentation API REST</title>
  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700&display=swap" rel="stylesheet">
  <style>
    /* Styles globaux */
    body {
      font-family: 'Roboto', sans-serif;
      background: linear-gradient(135deg, #f0f4f8, #d9e2ec);
      margin: 0;
      padding: 0;
      color: #333;
      line-height: 1.6;
    }
    .container {
      max-width: 1200px;
      margin: 30px auto;
      background: #fff;
      padding: 30px;
      border-radius: 8px;
      box-shadow: 0 8px 16px rgba(0,0,0,0.1);
    }
    header {
      text-align: center;
      margin-bottom: 40px;
    }
    header h1 {
      font-size: 2.5em;
      margin: 0;
      color: #007bff;
    }
    header p {
      font-size: 1.2em;
      color: #666;
    }
    nav {
      background: #007bff;
      padding: 10px 20px;
      border-radius: 4px;
      margin-bottom: 30px;
    }
    nav ul {
      list-style: none;
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      margin: 0;
      padding: 0;
    }
    nav ul li {
      margin: 5px 15px;
    }
    nav ul li a {
      color: #fff;
      text-decoration: none;
      font-weight: 500;
      transition: color 0.3s ease;
    }
    nav ul li a:hover {
      color: #ffdd57;
    }
    section {
      margin-bottom: 40px;
    }
    section h2 {
      border-bottom: 2px solid #007bff;
      padding-bottom: 5px;
      margin-bottom: 20px;
    }
    pre.tree {
      background: #f7f9fc;
      border: 1px solid #e1e4e8;
      padding: 15px;
      border-radius: 4px;
      overflow-x: auto;
    }
    code {
      background: #f1f3f5;
      padding: 2px 5px;
      border-radius: 3px;
      font-size: 0.95em;
    }
    ul, ol {
      margin-left: 20px;
    }
    p {
      margin: 10px 0;
    }
    footer {
      text-align: center;
      padding: 20px;
      font-size: 0.9em;
      color: #777;
      border-top: 1px solid #e1e4e8;
    }
    @media (max-width: 768px) {
      nav ul {
        flex-direction: column;
        align-items: center;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>Documentation API REST</h1>
      <p>Par L. RUTELLA, M. FREY et L. LE MOULT</p>
    </header>
    <nav>
      <ul>
        <li><a href="#sommaire">Sommaire</a></li>
        <li><a href="#arborescence">Arborescence</a></li>
        <li><a href="#authenticate">authenticate.php</a></li>
        <li><a href="#config">config.php</a></li>
        <li><a href="#db">db.php</a></li>
        <li><a href="#orders">orders.php</a></li>
        <li><a href="#users">users.php</a></li>
        <li><a href="#admin_create_order">admin_create_order.php</a></li>
        <li><a href="#admin_create_user">admin_create_user.php</a></li>
        <li><a href="#admin_dashboard">admin_dashboard.php</a></li>
        <li><a href="#admin_delete_order">admin_delete_order.php</a></li>
        <li><a href="#admin_delete_token">admin_delete_token.php</a></li>
        <li><a href="#admin_delete_user">admin_delete_user.php</a></li>
        <li><a href="#admin_edit_order">admin_edit_order.php</a></li>
        <li><a href="#admin_edit_user">admin_edit_user.php</a></li>
        <li><a href="#admin_orders">admin_orders.php</a></li>
        <li><a href="#admin_tokens">admin_tokens.php</a></li>
        <li><a href="#admin_users">admin_users.php</a></li>
        <li><a href="#dashboard">Dashboard.php</a></li>
        <li><a href="#login">Login.php</a></li>
        <li><a href="#logout">logout.php</a></li>
        <li><a href="#register">register.php</a></li>
        <li><a href="#style">Style.css</a></li>
      </ul>
    </nav>
    
    <section id="sommaire">
      <h2>Sommaire</h2>
      <ol>
        <li>Arborescence des fichiers</li>
        <li>authenticate.php</li>
        <li>config.php</li>
        <li>db.php</li>
        <li>orders.php</li>
        <li>users.php</li>
        <li>admin_create_order.php</li>
        <li>admin_create_user.php</li>
        <li>admin_dashboard.php</li>
        <li>admin_delete_order.php</li>
        <li>admin_delete_token.php</li>
        <li>admin_delete_user.php</li>
        <li>admin_edit_order.php</li>
        <li>admin_edit_user.php</li>
        <li>admin_orders.php</li>
        <li>admin_tokens.php</li>
        <li>admin_users.php</li>
        <li>Dashboard.php</li>
        <li>Login.php</li>
        <li>logout.php</li>
        <li>register.php</li>
        <li>Style.css</li>
      </ol>
    </section>
    
    <section id="arborescence">
      <h2>Arborescence des fichiers</h2>
      <pre class="tree">
├── authenticate.php
├── config.php
├── db.php
├── orders.php
├── users.php
└── web
    ├── admin_create_order.php
    ├── admin_create_user.php
    ├── admin_dashboard.php
    ├── admin_delete_order.php
    ├── admin_delete_token.php
    ├── admin_delete_user.php
    ├── admin_edit_order.php
    ├── admin_edit_user.php
    ├── admin_orders.php
    ├── admin_tokens.php
    ├── admin_users.php
    ├── dashboard.php
    ├── login.php
    ├── logout.php
    ├── register.php
    └── style.css
      </pre>
    </section>
    
    <section id="authenticate">
      <h2>authenticate.php</h2>
      <p><strong>Méthodes :</strong> POST</p>
      <p><strong>Arguments :</strong> Requis : <code>email</code>, <code>mdp</code></p>
      <p><strong>Utilité :</strong></p>
      <p>Dépendante de <code>db.php</code></p>
      <p>Permet, si la méthode est POST (sinon message d’erreur) et si les arguments sont correctement renseignés (sinon message d’erreur), d’affecter à des variables <code>$email</code> et <code>$mdp</code> les entrées utilisateurs afin d’exécuter une requête SQL pour récupérer l’utilisateur (via l’email unique).</p>
      <p>Si l’utilisateur existe (sinon message d’erreur), on vérifie son mot de passe.</p>
      <p>Si le mot de passe correspond, le code crée un token (sinon message d’erreur) qui est hashé.</p>
      <p>Enfin, le code insère dans la base de données (table <code>user_token</code>) le token hashé et l’<code>user_id</code>, puis affiche le résultat à l’utilisateur.</p>
    </section>
    
    <section id="config">
      <h2>config.php</h2>
      <p><strong>Utilité :</strong></p>
      <p>Ce fichier contient les login/mot de passe d’authentification à la BDD.</p>
      <p>D’abord, <code>$host</code> indique la localisation de la BDD, puis le nom de la base de données dans <code>$dbname</code>, suivi du nom d’utilisateur (<code>$username</code>) et enfin du mot de passe.</p>
    </section>
    
    <section id="db">
      <h2>db.php</h2>
      <p><strong>Utilité :</strong></p>
      <p>Ce fichier nécessite le fichier de configuration <code>config.php</code> pour fonctionner.</p>
      <p>Le code gère les erreurs via un bloc <code>try &amp; catch</code> puis essaie d’initialiser un nouvel objet PDO dans la variable <code>$pdo</code> avec les informations de <code>config.php</code>. En cas d’échec, un message d’erreur est affiché.</p>
    </section>
    
    <section id="orders">
      <h2>orders.php</h2>
      <p><strong>Méthodes :</strong> POST, GET, PUT, DELETE</p>
      <p><strong>Arguments :</strong> Requis : <code>numero_commande</code>, <code>prix</code>, <code>objet</code>, <code>date_livraison</code>, <code>status</code> | Facultatif : <code>user_id</code></p>
      <p><strong>Utilité :</strong></p>
      <p>Ce fichier nécessite <code>db.php</code> pour fonctionner et exporte ses résultats au format JSON.</p>
      <p>Il authentifie l’utilisateur via le token passé dans l’URL (<code>?token=...</code>). En cas d’absence, un message d’erreur est affiché.</p>
      <p>Le token est stocké dans la variable <code>$rawToken</code>, puis vérifié via une requête SQL pour s’assurer de sa présence dans la BDD (table <code>user_token</code>). Sinon, un message d’erreur est renvoyé.</p>
      <p>La variable <code>$CurrentUser</code> est initialisée avec les informations de l’utilisateur récupérées (notamment l’<code>user_id</code>).</p>
      <p>En fonction de la méthode utilisée (stockée dans la variable <code>$methode</code>) :</p>
      <ul>
        <li>Si la méthode est GET :
          <ul>
            <li>Si l’utilisateur a l’argument <code>admin</code> à 1 :
              <ul>
                <li>Si un <code>id</code> est renseigné, affiche la commande correspondante via une requête SQL.</li>
                <li>Sinon, si un numéro de commande est renseigné, affiche la commande correspondante via une requête SQL.</li>
                <li>Sinon, affiche toutes les commandes via une requête SQL.</li>
              </ul>
            </li>
            <li>Sinon, pour un utilisateur non admin :
              <ul>
                <li>Si un <code>id</code> est renseigné, affiche la commande correspondante uniquement si elle appartient à l’utilisateur.</li>
                <li>Sinon, si un numéro de commande est renseigné, affiche la commande correspondante uniquement si elle appartient à l’utilisateur.</li>
                <li>Sinon, affiche toutes les commandes de l’utilisateur via une requête SQL.</li>
              </ul>
            </li>
            <li>Le code s’arrête.</li>
          </ul>
        </li>
        <li>Si la méthode est POST :
          <ul>
            <li>Si un argument requis manque, affiche une erreur.</li>
            <li>Si l’utilisateur authentifié est admin et qu’un <code>user_id</code> est indiqué, l’utilisateur peut voir les commandes de cet <code>user_id</code>, sinon l’<code>user_id</code> utilisé sera celui de l’utilisateur authentifié.</li>
            <li>Initialise les variables <code>$numero_de_commande</code>, <code>$prix</code>, <code>$objet</code>, <code>$date_livraison</code> et <code>$status</code>.</li>
            <li>Exécute une requête SQL pour insérer la commande dans la BDD. En cas d’échec, affiche une erreur et arrête le code.</li>
          </ul>
        </li>
        <li>Si la méthode est PUT :
          <ul>
            <li>Vérifie que l’<code>id</code> de la commande est renseigné, sinon affiche une erreur.</li>
            <li>Si l’utilisateur n’a pas l’argument <code>admin == 1</code>, vérifie via SQL son éligibilité à modifier la commande. En cas d’inéligibilité, affiche une erreur et arrête le code.</li>
            <li>Sinon, récupère les données, crée deux listes (<code>$fields</code> et <code>$values</code>) et vérifie les données à mettre à jour. Si aucune donnée n’est fournie, affiche une erreur.</li>
            <li>Exécute la mise à jour via une requête SQL, puis arrête le code.</li>
          </ul>
        </li>
        <li>Si la méthode est DELETE :
          <ul>
            <li>Vérifie que l’<code>id</code> de la commande est renseigné, sinon affiche une erreur.</li>
            <li>Si l’utilisateur n’a pas l’argument <code>admin == 1</code>, vérifie son éligibilité via SQL. En cas d’inéligibilité, affiche une erreur et arrête le code.</li>
            <li>Si éligible, exécute une requête SQL pour supprimer la commande et affiche le résultat (ou une erreur en cas d’échec).</li>
            <li>Le code s’arrête.</li>
          </ul>
        </li>
        <li>Si la méthode n’est pas reconnue, affiche un message d’erreur et arrête le code.</li>
      </ul>
    </section>
    
    <section id="users">
      <h2>users.php</h2>
      <p><strong>Méthodes :</strong> POST, GET, PUT, DELETE</p>
      <p><strong>Arguments :</strong> Requis : <code>nom</code>, <code>prénom</code>, <code>mdp</code>, <code>email</code> | Facultatif : <code>adresse</code>, <code>n_tel</code>, <code>admin</code></p>
      <p><strong>Utilité :</strong></p>
      <p>Ce fichier nécessite <code>db.php</code> pour fonctionner et exporte les résultats en JSON.</p>
      <p>Authentifie l’utilisateur via le token passé dans l’URL (<code>?token=...</code>). Si le token est absent, affiche un message d’erreur.</p>
      <p>Stocke le token dans la variable <code>$rawToken</code> et vérifie via SQL sa présence dans la table <code>user_token</code>.</p>
      <p>Initialise la variable <code>$CurrentUser</code> avec les informations de l’utilisateur (notamment l’<code>user_id</code>).</p>
      <p>Selon la méthode utilisée :</p>
      <ul>
        <li>GET :
          <ul>
            <li>Si l’utilisateur a l’argument <code>admin</code> à 1 et qu’un <code>id</code> est renseigné, affiche l’utilisateur correspondant via SQL.</li>
            <li>Sinon, affiche tous les utilisateurs via SQL.</li>
          </ul>
        </li>
        <li>Pour un utilisateur non admin, si un <code>id</code> est renseigné, affiche uniquement l’utilisateur correspondant (s’il lui appartient).</li>
        <li>POST :
          <ul>
            <li>Si l’utilisateur a l’argument <code>admin</code> à 1, il peut créer un utilisateur ; sinon, affiche un message de refus et arrête le code.</li>
            <li>Vérifie que les arguments requis sont renseignés, sinon affiche une erreur et arrête le code.</li>
            <li>Initialise les variables correspondant aux arguments et exécute une requête SQL pour insérer l’utilisateur. Affiche le succès ou l’erreur, puis arrête le code.</li>
          </ul>
        </li>
        <li>PUT :
          <ul>
            <li>Vérifie que l’<code>id</code> de l’utilisateur à modifier est renseigné, sinon affiche une erreur et arrête le code.</li>
            <li>Si l’utilisateur n’a pas l’argument <code>admin</code> à 1 et que l’<code>id</code> fourni ne correspond pas au sien, affiche une erreur (un utilisateur non admin ne peut modifier que son propre compte).</li>
            <li>Récupère les données, crée deux listes (<code>$fields</code> et <code>$values</code>) pour mettre à jour les champs. Si aucune donnée n’est fournie, affiche une erreur.</li>
            <li>Exécute la mise à jour via SQL, puis arrête le code.</li>
          </ul>
        </li>
        <li>DELETE :
          <ul>
            <li>Vérifie que l’<code>id</code> de l’utilisateur à supprimer est renseigné, sinon affiche une erreur et arrête le code.</li>
            <li>Si l’utilisateur n’a pas l’argument <code>admin</code> à 1 et que l’<code>id</code> fourni ne correspond pas au sien, affiche une erreur (un utilisateur non admin ne peut supprimer que son propre compte) et arrête le code.</li>
            <li>Exécute une requête SQL pour supprimer l’utilisateur et affiche le résultat, puis arrête le code.</li>
          </ul>
        </li>
        <li>Si la méthode n’est pas indiquée, affiche un message d’erreur et arrête le code.</li>
      </ul>
    </section>
    
    <section id="admin_create_order">
      <h2>admin_create_order.php</h2>
      <p><strong>Méthodes :</strong> POST</p>
      <p><strong>Arguments :</strong> Requis : <code>user_id</code>, <code>numero_commande</code>, <code>prix</code>, <code>objet</code>, <code>date_livraison</code>, <code>status</code></p>
      <p><strong>Utilité :</strong></p>
      <p>Ce fichier nécessite <code>db.php</code> pour fonctionner.</p>
      <p>Démarre une session. Si l’utilisateur n’est pas authentifié, il est redirigé vers <code>login.php</code>.</p>
      <p>Si la méthode est POST, récupère les arguments, exécute une requête SQL pour insérer la commande dans la BDD et, en cas de succès, redirige vers <code>admin_orders.php</code>. Sinon, affiche une erreur.</p>
    </section>
    
    <section id="admin_create_user">
      <h2>admin_create_user.php</h2>
      <p><strong>Méthodes :</strong> POST</p>
      <p><strong>Arguments :</strong> Requis : <code>nom</code>, <code>prenom</code>, <code>email</code>, <code>mdp</code>, <code>adresse</code>, <code>n_tel</code>, <code>admin</code></p>
      <p><strong>Utilité :</strong></p>
      <p>Ce fichier nécessite <code>db.php</code> pour fonctionner.</p>
      <p>Démarre une session. Si l’utilisateur n’est pas authentifié, il est redirigé vers <code>login.php</code>.</p>
      <p>Si la méthode est POST, récupère les arguments, exécute une requête SQL pour créer un nouvel utilisateur et, en cas de succès, redirige vers <code>admin_users.php</code>. Sinon, affiche une erreur.</p>
    </section>
    
    <section id="admin_dashboard">
      <h2>admin_dashboard.php</h2>
      <p><strong>Utilité :</strong></p>
      <p>Démarre une session. Si l’utilisateur n’est pas authentifié, il est redirigé vers <code>login.php</code>.</p>
      <p>Affiche les éléments graphiques permettant à l’utilisateur admin de se rediriger vers <code>admin_users.php</code>, <code>admin_orders.php</code>, <code>admin_tokens.php</code> et <code>logout.php</code>.</p>
    </section>
    
    <section id="admin_delete_order">
      <h2>admin_delete_order.php</h2>
      <p><strong>Utilité :</strong></p>
      <p>Ce fichier nécessite <code>db.php</code> pour fonctionner.</p>
      <p>Démarre une session. Si l’utilisateur n’est pas authentifié, il est redirigé vers <code>login.php</code>.</p>
      <p>Si un argument <code>id</code> est fourni, exécute une requête SQL pour supprimer la commande correspondante. En cas de succès, redirige vers <code>admin_orders.php</code>, sinon affiche une erreur.</p>
      <p>Si aucun <code>id</code> n’est fourni, redirige vers <code>admin_orders.php</code>.</p>
    </section>
    
    <section id="admin_delete_token">
      <h2>admin_delete_token.php</h2>
      <p><strong>Utilité :</strong></p>
      <p>Ce fichier nécessite <code>db.php</code> pour fonctionner.</p>
      <p>Démarre une session. Si l’utilisateur n’est pas authentifié, il est redirigé vers <code>login.php</code>.</p>
      <p>Si un argument <code>id</code> est fourni, exécute une requête SQL pour supprimer le token correspondant. En cas de succès, redirige vers <code>admin_tokens.php</code>, sinon affiche une erreur.</p>
      <p>Si aucun <code>id</code> n’est fourni, redirige vers <code>admin_tokens.php</code>.</p>
    </section>
    
    <section id="admin_delete_user">
      <h2>admin_delete_user.php</h2>
      <p><strong>Utilité :</strong></p>
      <p>Ce fichier nécessite <code>db.php</code> pour fonctionner.</p>
      <p>Démarre une session. Si l’utilisateur n’est pas authentifié, il est redirigé vers <code>login.php</code>.</p>
      <p>Si un argument <code>id</code> est fourni, exécute une requête SQL pour supprimer l’utilisateur correspondant. En cas de succès, redirige vers <code>admin_users.php</code>, sinon affiche une erreur.</p>
      <p>Si aucun <code>id</code> n’est fourni, redirige vers <code>admin_users.php</code>.</p>
    </section>
    
    <section id="admin_edit_order">
      <h2>admin_edit_order.php</h2>
      <p><strong>Utilité :</strong></p>
      <p>Ce fichier nécessite <code>db.php</code> pour fonctionner.</p>
      <p>Démarre une session. Si l’utilisateur n’est pas authentifié, il est redirigé vers <code>login.php</code>.</p>
      <p>Si aucun argument <code>id</code> n’est fourni, redirige vers <code>admin_orders.php</code>.</p>
      <p>Sinon, affecte l’<strong>id</strong> à la variable <code>$orderId</code> et prépare une requête SQL pour rechercher la commande correspondante.</p>
      <p>Si la commande n’est pas trouvée, affiche une erreur et arrête le code. Sinon, initialise les arguments à modifier et crée une requête SQL pour effectuer la ou les modifications.</p>
      <p>En cas de succès, redirige vers <code>admin_orders.php</code>, sinon affiche une erreur. Affiche ensuite les éléments graphiques pour remplir les champs de modification.</p>
    </section>
    
    <section id="admin_edit_user">
      <h2>admin_edit_user.php</h2>
      <p><strong>Utilité :</strong></p>
      <p>Ce fichier nécessite <code>db.php</code> pour fonctionner.</p>
      <p>Démarre une session. Si l’utilisateur n’est pas authentifié, il est redirigé vers <code>login.php</code>.</p>
      <p>Si aucun argument <code>id</code> n’est fourni, redirige vers <code>admin_users.php</code>.</p>
      <p>Sinon, affecte l’<strong>id</strong> à la variable <code>$id</code> et prépare une requête SQL pour rechercher l’utilisateur correspondant.</p>
      <p>Si l’utilisateur n’est pas trouvé, affiche une erreur et arrête le code. Sinon, initialise les arguments à modifier (à l’exception du mot de passe, sauf s’il a été changé) et crée une requête SQL pour effectuer la ou les modifications.</p>
      <p>En cas de succès, redirige vers <code>admin_users.php</code>, sinon affiche une erreur. Affiche ensuite les éléments graphiques pour remplir les champs de modification.</p>
    </section>
    
    <section id="admin_orders">
      <h2>admin_orders.php</h2>
      <p><strong>Utilité :</strong></p>
      <p>Ce fichier nécessite <code>db.php</code> pour fonctionner.</p>
      <p>Démarre une session. Si l’utilisateur n’est pas authentifié, redirige vers <code>login.php</code>.</p>
      <p>Affiche les éléments graphiques permettant de visualiser toutes les commandes, de les supprimer ou de les modifier via une boucle récursive, ou de créer une nouvelle commande.</p>
      <p>Permet également de revenir au dashboard principal (<code>admin_dashboard.php</code>).</p>
    </section>
    
    <section id="admin_tokens">
      <h2>admin_tokens.php</h2>
      <p><strong>Utilité :</strong></p>
      <p>Ce fichier est utilisé pour la gestion des clés API (tokens) des utilisateurs.</p>
      <p>Dépend de <code>db.php</code> et <code>style.css</code> pour l'affichage.</p>
      <p><strong>Fonctionnement :</strong></p>
      <ul>
        <li>Démarre une session (<code>session_start()</code>) et vérifie que l’utilisateur est connecté avec les droits d’administration (<code>admin = 1</code>). Sinon, redirige vers <code>login.php</code>.</li>
        <li>Exécute une requête SQL pour récupérer tous les tokens dans la table <code>user_tokens</code>, les associe à l’email correspondant et les trie par date de création (<code>created_at</code>).</li>
        <li>Exécute une requête SQL pour récupérer tous les utilisateurs, triés par ordre croissant d’ID.</li>
        <li>Si la requête est de type POST avec le paramètre <code>create_token</code> :
          <ul>
            <li>Récupère l’<code>id</code> de l’utilisateur concerné.</li>
            <li>Vérifie si l’utilisateur existe dans la BDD.</li>
            <li>Si oui, génère un token brut (<code>bin2hex(random_bytes(16))</code>), le hash avec <code>password_hash()</code>, l’insère dans la table <code>user_tokens</code> avec l’<code>id</code> utilisateur et affiche le token brut une seule fois.</li>
            <li>Sinon, affiche un message d’erreur.</li>
          </ul>
        </li>
        <li>Affiche un formulaire permettant de sélectionner un utilisateur pour générer un token.</li>
        <li>Affiche les tokens existants avec leurs informations (ID, utilisateur associé, date de création).</li>
        <li>Affiche un message en cas de succès ou d’erreur.</li>
        <li>Fournit un lien pour retourner au dashboard admin (<code>admin_dashboard.php</code>).</li>
      </ul>
    </section>
    
    <section id="admin_users">
      <h2>admin_users.php</h2>
      <p><strong>Utilité :</strong></p>
      <p>Ce fichier nécessite <code>db.php</code> pour fonctionner.</p>
      <p>Démarre une session. Si l’utilisateur n’est pas authentifié, redirige vers <code>login.php</code>.</p>
      <p>Affiche les éléments graphiques permettant de visualiser tous les utilisateurs avec des options pour supprimer ou modifier via une boucle récursive, ou créer un nouvel utilisateur.</p>
      <p>Permet également de revenir au dashboard principal (<code>admin_dashboard.php</code>).</p>
    </section>
    
    <section id="dashboard">
      <h2>Dashboard.php</h2>
      <p><strong>Utilité :</strong></p>
      <p>Ce fichier est utilisé pour la gestion des clés API d’un utilisateur connecté.</p>
      <p>Dépend de <code>db.php</code> et <code>style.css</code>.</p>
      <p>Démarre une session et vérifie si l’utilisateur est connecté (<code>$_SESSION['user']</code>), sinon redirige vers <code>login.php</code>.</p>
      <p>Exécute une requête SQL pour récupérer les clés API associées à l’utilisateur connecté et les trie par date de création (<code>created_at</code>).</p>
      <p>Si la requête est de type POST avec le paramètre <code>generate</code>, génère une clé API brute (<code>bin2hex(random_bytes(16))</code>), la hash avec <code>password_hash()</code>, l’insère dans la table <code>user_tokens</code> avec l’ID de l’utilisateur, et affiche la clé brute une seule fois.</p>
      <p>Si la requête est de type POST avec le paramètre <code>delete_token</code>, récupère l’ID de la clé à supprimer, vérifie qu’elle appartient à l’utilisateur connecté, et la supprime via SQL.</p>
      <p>Affiche également un bouton pour se déconnecter (<code>logout</code>).</p>
    </section>
    
    <section id="login">
      <h2>Login.php</h2>
      <p><strong>Utilité :</strong></p>
      <p>Ce fichier gère l’authentification des utilisateurs en leur permettant de se connecter et en les redirigeant selon leur rôle (administrateur ou utilisateur standard).</p>
      <p>Dépend de <code>db.php</code> et <code>style.css</code>.</p>
      <p>Démarre une session (<code>session_start()</code>) et active l'affichage des erreurs (<code>error_reporting(E_ALL)</code>).</p>
      <p>Si le formulaire de connexion est soumis (<code>POST['login']</code>), récupère l’email et le mot de passe saisis, exécute une requête SQL pour récupérer l’utilisateur correspondant, et vérifie le mot de passe avec <code>password_verify()</code>.</p>
      <p>Si les identifiants sont corrects, stocke les informations dans <code>$_SESSION['user']</code> et redirige vers <code>admin_dashboard.php</code> pour un administrateur ou <code>dashboard.php</code> pour un utilisateur standard.</p>
      <p>Si les identifiants sont incorrects, affiche un message d’erreur et propose un lien vers <code>register.php</code> pour s'inscrire.</p>
    </section>
    
    <section id="logout">
      <h2>logout.php</h2>
      <p><strong>Utilité :</strong></p>
      <p>Ce fichier permet de déconnecter un utilisateur en détruisant sa session et en le redirigeant vers la page de connexion (<code>login.php</code>).</p>
      <p>Démarre la session (<code>session_start()</code>), supprime toutes les données de session (<code>session_destroy()</code>), redirige vers <code>login.php</code> et termine l'exécution du script avec <code>exit;</code>.</p>
    </section>
    
    <section id="register">
      <h2>register.php</h2>
      <p><strong>Utilité :</strong></p>
      <p>Ce fichier permet aux utilisateurs de créer un compte en s'inscrivant avec leurs informations personnelles.</p>
      <p>Dépend de <code>db.php</code> et <code>style.css</code>.</p>
      <p>Vérifie si le formulaire a été soumis (<code>isset($_POST['register'])</code>), récupère les informations saisies (<code>nom</code>, <code>prenom</code>, <code>email</code>, <code>mdp</code>, <code>adresse</code>, <code>n_tel</code>), hash le mot de passe avec <code>password_hash()</code>, puis vérifie via SQL si l'email existe déjà (<code>SELECT id FROM users WHERE email = ?</code>).</p>
      <p>Si l'email est unique, insère les informations dans la BDD (<code>INSERT INTO users (...) </code>) et affiche un message de succès ou d'erreur, puis propose un lien vers <code>login.php</code> pour se connecter.</p>
    </section>
    
    <section id="style">
      <h2>Style.css</h2>
      <p><strong>Utilité :</strong></p>
      <p>Ce fichier définit les styles CSS de l'interface utilisateur pour assurer une mise en page claire et agréable.</p>
      <p>Dépendances : Aucune, mais il est utilisé par plusieurs fichiers HTML et PHP pour uniformiser l'apparence.</p>
      <p><strong>Fonctionnement :</strong></p>
      <ul>
        <li><strong>Styles généraux :</strong> Définit une police de base (Arial, sans-serif), une couleur de fond gris clair (<code>#f4f4f4</code>) et supprime les marges et paddings par défaut du <code>body</code>.</li>
        <li><strong>Mise en page :</strong> La classe <code>.container</code> définit une largeur maximale, centre le contenu (<code>margin: 30px auto</code>), ajoute un fond blanc, des bordures arrondies et une ombre portée.</li>
        <li><strong>Titres et textes :</strong> Les balises <code>h2, h3</code> ont une couleur de texte foncée (<code>#333</code>) et les <code>label</code> sont affichés en bloc avec une marge en haut (<code>margin-top: 10px</code>) et en gras.</li>
        <li><strong>Champs de formulaire :</strong> Les <code>input[type="text"]</code>, <code>input[type="email"]</code> et <code>input[type="password"]</code> ont une largeur de 100%, une bordure grise (<code>#ccc</code>), un padding et une marge en bas.</li>
        <li><strong>Boutons :</strong> Les <code>button</code> ont un fond bleu (<code>#007bff</code>), texte blanc, arrondis et un effet de survol (fond <code>#0056b3</code>).</li>
        <li><strong>Messages :</strong> La classe <code>.message</code> affiche un fond vert clair (<code>#dff0d8</code>) pour les succès et <code>.message.error</code> un fond rouge clair (<code>#f2dede</code>) pour les erreurs.</li>
        <li><strong>Tableaux :</strong> Les balises <code>table</code> ont des bordures grises (<code>#ddd</code>), un padding et un en-tête avec un fond légèrement gris (<code>#f8f8f8</code>).</li>
        <li><strong>Liens :</strong> Les balises <code>a</code> ont une couleur bleue (<code>#007bff</code>) et un soulignement au survol.</li>
      </ul>
      <p>Exemple :</p>
      <pre>
body {
  font-family: 'Roboto', sans-serif;
  background: linear-gradient(135deg, #f0f4f8, #d9e2ec);
  color: #333;
  margin: 0;
  padding: 0;
}
.container { ... }
      </pre>
    </section>
    
    <footer>
      <p>Documentation API REST &copy; 2025</p>
    </footer>
  </div>
</body>
</html>
